
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Mutations - vue.js</title>
        <meta charset="utf-8">
        <meta name="description" content="Vue.js - Intuitive, Fast and Composable MVVM for building interactive interfaces.">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <link rel="icon" href="/images/logo.png" type="image/x-icon">
        <script>
            window.PAGE_TYPE = "vuex"
        </script>
        <link rel="stylesheet" href="/css/page.css">
        
        <script src="/js/vue.js"></script>
    </head>
    <body>
        <div id="mobile-bar" >
            <a class="menu-button"></a>
            <a class="logo" href="/"></a>
        </div>
        <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>Vue.js v2.0 中文</span>
  </a>
  <span style="
    position: absolute;
    top: 100%;
    left: 60px;
    padding: 0 10px;
    background: #ef9f00;
    border-radius: 3px;
    margin-top: -15px;
    line-height: 30px;
    color: white;
    font-weight: 400;
    letter-spacing: 1px;
    box-shadow: 0 1px 2px rgba(0,0,0,.3);
  ">
  进群参与:427447379
  </span>
  <ul id="nav">
    <li><a href="/guide/" class="nav-link">教程</a></li>
<li><a href="/api/" class="nav-link">API</a></li>
<li><a href="/about/" class="nav-link">参与贡献</a></li>
<li><a href="/router/" class="nav-link">vue-router</a></li>
<li><a href="/vuex/" class="nav-link current">vuex</a></li>
<li><a href="/examples/" class="nav-link">示例</a></li>
<li><a href="/more/" class="nav-link">更多</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">社区</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/vuejs/vue" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="http://forum.vuejs.org" class="nav-link" target="_blank">论坛</a></li>
    <li><a href="https://gitter.im/vuejs/vue" class="nav-link" target="_blank">聊天室</a></li>
    <li><a href="https://twitter.com/vuejs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


  </ul>
</div>

        
            <div id="main">
                
                    
    <div class="sidebar">
    <ul class="main-menu">
        <li><a href="/guide/" class="nav-link">教程</a></li>
<li><a href="/api/" class="nav-link">API</a></li>
<li><a href="/about/" class="nav-link">参与贡献</a></li>
<li><a href="/router/" class="nav-link">vue-router</a></li>
<li><a href="/vuex/" class="nav-link current">vuex</a></li>
<li><a href="/examples/" class="nav-link">示例</a></li>
<li><a href="/more/" class="nav-link">更多</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">社区</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/vuejs/vue" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="http://forum.vuejs.org" class="nav-link" target="_blank">论坛</a></li>
    <li><a href="https://gitter.im/vuejs/vue" class="nav-link" target="_blank">聊天室</a></li>
    <li><a href="https://twitter.com/vuejs" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>


    </ul>
    <div class="list">
        <div id="donate" style="margin-bottom: 20px">
            <span class="wrapper" style="width: 110px">
              <img src="/images/patreon.png">
              <a href="/support-vuejs">支持 Vue.js</a>
            </span>
        </div>
        <h2>
            
            
            <select class="version-select">
                <option value="SELF" selected>2.0</option>
            </select>
        </h2>
        <ul class="menu-root">
            
                
                
                
                
                
                <li>
                    <a href="/vuex/index.html" class="sidebar-link">Vuex 目录</a>
                </li>
            
                
                
                  <li><h3>基础</h3></li>
                
                
                
                
                <li>
                    <a href="/vuex/installation.html" class="sidebar-link">安装</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/intro.html" class="sidebar-link">什么是 Vuex</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/getting-started.html" class="sidebar-link">起步</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/state.html" class="sidebar-link">State</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/getters.html" class="sidebar-link">Getters</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/mutations.html" class="sidebar-link current">Mutations</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/actions.html" class="sidebar-link">Actions</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/modules.html" class="sidebar-link">Modules</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/structure.html" class="sidebar-link">应用结构</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/plugins.html" class="sidebar-link">插件</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/strict.html" class="sidebar-link">严格模式</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/forms.html" class="sidebar-link">表单处理</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/testing.html" class="sidebar-link">测试</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/hot-reload.html" class="sidebar-link">热加载</a>
                </li>
            
                
                
                
                
                
                <li>
                    <a href="/vuex/api.html" class="sidebar-link">API</a>
                </li>
            
             
        </ul>
    </div>
</div>


<div class="content vuex with-sidebar ">
    	
    <h1>Mutations</h1>
    <h1 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h1><p>The only way to actually change state in a Vuex store is by committing a mutation. Vuex mutations are very similar to events: each mutation has a string <strong>type</strong> and a <strong>handler</strong>. The handler function is where we perform actual state modifications, and it will receive the state as the first argument:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</div><div class="line">  <span class="attr">state</span>: &#123;</div><div class="line">    <span class="attr">count</span>: <span class="number">1</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">mutations</span>: &#123;</div><div class="line">    increment (state) &#123;</div><div class="line">      <span class="comment">// mutate state</span></div><div class="line">      state.count++</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>You cannot directly call a mutation handler. The options here is more like event registration: “When a mutation with type <code>increment</code> is triggered, call this handler.” To invoke a mutation handler, you need to call <strong>store.commit</strong> with its type:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(<span class="string">'increment'</span>)</div></pre></td></tr></table></figure>
<h3 id="Commit-with-Payload"><a href="#Commit-with-Payload" class="headerlink" title="Commit with Payload"></a>Commit with Payload</h3><p>You can pass an additional argument to <code>store.commit</code>, which is called the <strong>payload</strong> for the mutation:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">mutations: &#123;</div><div class="line">  increment (state, n) &#123;</div><div class="line">    state.count += n</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(<span class="string">'increment'</span>, <span class="number">10</span>)</div></pre></td></tr></table></figure>
<p>In most cases, the payload should be an object so that it can contain multiple fields, and the recorded mutation will also be more descriptive:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ...</span></div><div class="line">mutations: &#123;</div><div class="line">  increment (state, payload) &#123;</div><div class="line">    state.count += payload.amount</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(<span class="string">'increment'</span>, &#123;</div><div class="line">  <span class="attr">amount</span>: <span class="number">10</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Object-Style-Commit"><a href="#Object-Style-Commit" class="headerlink" title="Object-Style Commit"></a>Object-Style Commit</h3><p>An alternative way to commit a mutation is by directly using an object that has a <code>type</code> property:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'increment'</span>,</div><div class="line">  <span class="attr">amount</span>: <span class="number">10</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>When using object-style commit, the entire object will be passed as the payload to mutation handlers, so the handler remains the same:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">mutations: &#123;</div><div class="line">  increment (state, payload) &#123;</div><div class="line">    state.count += payload.amount</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Silent-Commit"><a href="#Silent-Commit" class="headerlink" title="Silent Commit"></a>Silent Commit</h3><blockquote>
<p>Note: This is a feature that will likely be deprecated once we implement mutation filtering in the devtools.</p>
</blockquote>
<p>By default, every committed mutation is sent to plugins (e.g. the devtools). However in some scenarios you may not want the plugins to record every state change. Multiple commits to the store in a short period or polled do not always need to be tracked. In such cases you can pass a third argument to <code>store.commit</code> to “silence” that specific mutation from plugins:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(<span class="string">'increment'</span>, &#123;</div><div class="line">  <span class="attr">amount</span>: <span class="number">1</span></div><div class="line">&#125;, &#123; <span class="attr">silent</span>: <span class="literal">true</span> &#125;)</div><div class="line"></div><div class="line"><span class="comment">// with object-style dispatch</span></div><div class="line">store.commit(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'increment'</span>,</div><div class="line">  <span class="attr">amount</span>: <span class="number">1</span></div><div class="line">&#125;, &#123; <span class="attr">silent</span>: <span class="literal">true</span> &#125;)</div></pre></td></tr></table></figure>
<h3 id="Mutations-Follow-Vue’s-Reactivity-Rules"><a href="#Mutations-Follow-Vue’s-Reactivity-Rules" class="headerlink" title="Mutations Follow Vue’s Reactivity Rules"></a>Mutations Follow Vue’s Reactivity Rules</h3><p>Since a Vuex store’s state is made reactive by Vue, when we mutate the state, Vue components observing the state will update automatically. This also means Vuex mutations are subject to the same reactivity caveats when working with plain Vue:</p>
<ol>
<li><p>Prefer initializing your store’s initial state with all desired fields upfront.</p>
</li>
<li><p>When adding new properties to an Object, you should either:</p>
<ul>
<li><p>Use <code>Vue.set(obj, &#39;newProp&#39;, 123)</code>, or -</p>
</li>
<li><p>Replace that Object with a fresh one. For example, using the stage-2 <a href="https://github.com/sebmarkbage/ecmascript-rest-spread" target="_blank" rel="external">object spread syntax</a> we can write it like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">state.obj = &#123; ...state.obj, <span class="attr">newProp</span>: <span class="number">123</span> &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="Using-Constants-for-Mutation-Names"><a href="#Using-Constants-for-Mutation-Names" class="headerlink" title="Using Constants for Mutation Names"></a>Using Constants for Mutation Names</h3><p>It is a commonly seen pattern to use constants for mutation types in various Flux implementations. This allow the code to take advantage of tooling like linters, and putting all constants in a single file allows your collaborators to get an at-a-glance view of what mutations are possible in the entire application:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// mutation-types.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> SOME_MUTATION = <span class="string">'SOME_MUTATION'</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// store.js</span></div><div class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></div><div class="line"><span class="keyword">import</span> &#123; SOME_MUTATION &#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</div><div class="line">  <span class="attr">state</span>: &#123; ... &#125;,</div><div class="line">  <span class="attr">mutations</span>: &#123;</div><div class="line">    <span class="comment">// we can use the ES2015 computed property name feature</span></div><div class="line">    <span class="comment">// to use a constant as the function name</span></div><div class="line">    [SOME_MUTATION] (state) &#123;</div><div class="line">      <span class="comment">// mutate state</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Whether to use constants is largely a preference - it can be helpful in large projects with many developers, but it’s totally optional if you don’t like them.</p>
<h3 id="Mutations-Must-Be-Synchronous"><a href="#Mutations-Must-Be-Synchronous" class="headerlink" title="Mutations Must Be Synchronous"></a>Mutations Must Be Synchronous</h3><p>One important rule to remember is that <strong>mutation handler functions must be synchronous</strong>. Why? Consider the following example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">mutations: &#123;</div><div class="line">  someMutation (state) &#123;</div><div class="line">    api.callAsyncMethod(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      state.count++</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now imagine we are debugging the app and looking at the devtool’s mutation logs. For every mutation logged, the devtool will need to capture a “before” and “after” snapshots of the state. However, the asynchronous callback inside the example mutation above makes that impossible: the callback is not called yet when the mutation is committed, and there’s no way for the devtool to know when the callback will actually be called - any state mutation performed in the callback is essentially un-trackable!</p>
<h3 id="Commiting-Mutations-in-Components"><a href="#Commiting-Mutations-in-Components" class="headerlink" title="Commiting Mutations in Components"></a>Commiting Mutations in Components</h3><p>You can commit mutations in components with <code>this.$store.commit(&#39;xxx&#39;)</code>, or use the <code>mapMutations</code> helper which maps component methods to <code>store.commit</code> calls (requires root <code>store</code> injection):</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  methods: &#123;</div><div class="line">    ...mapMutations([</div><div class="line">      <span class="string">'increment'</span> <span class="comment">// map this.increment() to this.$store.commit('increment')</span></div><div class="line">    ]),</div><div class="line">    ...mapMutations(&#123;</div><div class="line">      <span class="attr">add</span>: <span class="string">'increment'</span> <span class="comment">// map this.add() to this.$store.commit('increment')</span></div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="On-to-Actions"><a href="#On-to-Actions" class="headerlink" title="On to Actions"></a>On to Actions</h3><p>Asynchronicity combined with state mutation can make your program very hard to reason about. For example, when you call two methods both with async callbacks that mutate the state, how do you know when they are called and which callback was called first? This is exactly why we want to separate the two concepts. In Vuex, <strong>mutations are synchronous transactions</strong>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">store.commit(<span class="string">'increment'</span>)</div><div class="line"><span class="comment">// any state change that the "increment" mutation may cause</span></div><div class="line"><span class="comment">// should be done at this moment.</span></div></pre></td></tr></table></figure>
<p>To handle asynchronous operations, let’s introduce <a href="actions.md">Actions</a>.</p>

    
    <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/dingyiming/vuejs.org/tree/2.0-cn/src/vuex/mutations.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
</div>

                
            </div>
            <script src="/js/smooth-scroll.min.js"></script>
            <script src="/js/common.js"></script>
        

        <script src="//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                FastClick.attach(document.body);
            }, false);
        </script>
    </body>
</html>
